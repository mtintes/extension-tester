name: 'publish to slack'
description: 'ya publish to slack'

inputs:
  slack_token:  # id of input
    required: true
    
runs:
  using: "composite"
  steps:
    - shell: bash
      id: set_payload
      run: |
        jsonMessage=`cat ./.github/actions/slack-publish/slack_test2.json`
        echo $jsonMessage
        #jsonMessage="${jsonMessage//'%'/'%25'}"
        #jsonMessage="${jsonMessage//$'\n'/'%0A'}"
        #jsonMessage="${jsonMessage//$'\r'/'%0D'}"
        jsonMessage=$(printf "%q" $jsonMessage)
        echo "::set-output name=payload::$jsonMessage"
    - shell: bash
      run: |
        ./.github/actions/slack-publish/slack_send.sh '${{ inputs.slack_token }}' "${{ steps.set_payload.outputs.payload }}"
